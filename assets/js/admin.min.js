!function(e){"use strict";function t(e){if(e){var t=new wp.shortcode({tag:"gallery",attrs:{ids:e},type:"single"}),o=wp.media.gallery.attachments(t),r=new wp.media.model.Selection(o.models,{props:o.props.toJSON(),multiple:!0});return r.gallery=o.gallery,r.more().done(function(){r.props.set({query:!1}),r.unmirror(),r.props.unset("orderby")}),r}return!1}var o,r=t(FilterablePortfolio.image_ids);e("#fp_gallery_btn").on("click",function(l){function i(){o.toolbar.get("view").set({insert:{style:"primary",text:FilterablePortfolio.save_btn_text,click:function(){var l="";o.state().get("library").each(function(e){l+=e.id+","}),this.el.innerHTML=FilterablePortfolio.progress_btn_text,e.ajax({type:"POST",url:FilterablePortfolio.ajaxurl,data:{ids:l,action:"fp_save_images",post_id:FilterablePortfolio.post_id,nonce:FilterablePortfolio.nonce},success:function(){r=t(l),e("#fp_images_ids").val(l),o.close()},dataType:"html"}).done(function(t){e(".fp_gallery_list").html(t)})}}})}l.preventDefault();var n={title:FilterablePortfolio.create_btn_text,state:"gallery-edit",frame:"post",selection:r};(o||r)&&(n.title=FilterablePortfolio.edit_btn_text),(o=wp.media(n).open()).menu.get("view").unset("cancel"),o.menu.get("view").unset("separateCancel"),o.menu.get("view").get("gallery-edit").el.innerHTML=FilterablePortfolio.edit_btn_text,o.content.get("view").sidebar.unset("gallery"),i(),o.on("toolbar:render:gallery-edit",function(){i()}),o.on("content:render:browse",function(e){e&&(e.sidebar.on("ready",function(){e.sidebar.unset("gallery")}),e.toolbar.on("ready",function(){"gallery-library"==e.toolbar.controller._state&&e.toolbar.$el.hide()}))}),o.state().get("library").on("remove",function(){0===o.state().get("library").length&&(r=!1,e.post(FilterablePortfolio.ajaxurl,{ids:"",action:"fp_save_images",post_id:FilterablePortfolio.post_id,nonce:FilterablePortfolio.nonce}))})})}(jQuery);